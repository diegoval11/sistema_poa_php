import{_ as d,C as l,o as e,c as o,j as i,a as s,b as r,w as t,E as p,a3 as h,a2 as c}from"./chunks/framework.BNd_iFDH.js";const _=JSON.parse('{"title":"Modelos y Base de Datos","description":"","frontmatter":{},"headers":[],"relativePath":"architecture/models.md","filePath":"architecture/models.md","lastUpdated":null}'),k={name:"architecture/models.md"};function E(A,a,m,g,b,u){const n=l("Mermaid");return e(),o("div",null,[a[1]||(a[1]=i("h1",{id:"modelos-y-base-de-datos",tabindex:"-1"},[s("Modelos y Base de Datos "),i("a",{class:"header-anchor",href:"#modelos-y-base-de-datos","aria-label":'Permalink to "Modelos y Base de Datos"'},"​")],-1)),a[2]||(a[2]=i("h2",{id:"diagrama-de-entidad-relacion",tabindex:"-1"},[s("Diagrama de Entidad-Relación "),i("a",{class:"header-anchor",href:"#diagrama-de-entidad-relacion","aria-label":'Permalink to "Diagrama de Entidad-Relación"'},"​")],-1)),(e(),r(h,null,{default:t(()=>[p(n,{id:"mermaid-6",class:"mermaid",graph:"erDiagram%0A%20%20%20%20UNIDADES%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20string%20nombre%0A%20%20%20%20%20%20%20%20boolean%20activa%0A%20%20%20%20%20%20%20%20boolean%20sin_reporte%0A%20%20%20%20%20%20%20%20datetime%20created_at%0A%20%20%20%20%20%20%20%20datetime%20updated_at%0A%20%20%20%20%7D%0A%20%20%20%20USERS%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20unidad_id%20FK%0A%20%20%20%20%20%20%20%20string%20name%0A%20%20%20%20%20%20%20%20string%20email%0A%20%20%20%20%20%20%20%20string%20password%0A%20%20%20%20%20%20%20%20string%20role%0A%20%20%20%20%20%20%20%20boolean%20debe_cambiar_clave%0A%20%20%20%20%20%20%20%20datetime%20created_at%0A%20%20%20%20%20%20%20%20datetime%20updated_at%0A%20%20%20%20%7D%0A%20%20%20%20POA_PROYECTOS%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20user_id%20FK%0A%20%20%20%20%20%20%20%20int%20aprobado_por%20FK%0A%20%20%20%20%20%20%20%20string%20nombre%0A%20%20%20%20%20%20%20%20year%20anio%0A%20%20%20%20%20%20%20%20text%20objetivo_unidad%0A%20%20%20%20%20%20%20%20enum%20estado%0A%20%20%20%20%20%20%20%20datetime%20fecha_aprobacion%0A%20%20%20%20%20%20%20%20text%20motivo_rechazo%0A%20%20%20%20%20%20%20%20datetime%20deleted_at%0A%20%20%20%20%20%20%20%20datetime%20created_at%0A%20%20%20%20%20%20%20%20datetime%20updated_at%0A%20%20%20%20%7D%0A%20%20%20%20POA_METAS%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20poa_proyecto_id%20FK%0A%20%20%20%20%20%20%20%20text%20descripcion%0A%20%20%20%20%20%20%20%20datetime%20created_at%0A%20%20%20%20%20%20%20%20datetime%20updated_at%0A%20%20%20%20%7D%0A%20%20%20%20POA_ACTIVIDADES%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20poa_meta_id%20FK%0A%20%20%20%20%20%20%20%20string%20descripcion%0A%20%20%20%20%20%20%20%20string%20unidad_medida%0A%20%20%20%20%20%20%20%20boolean%20es_cuantificable%0A%20%20%20%20%20%20%20%20boolean%20es_no_planificada%0A%20%20%20%20%20%20%20%20enum%20estado_aprobacion%0A%20%20%20%20%20%20%20%20int%20cantidad_programada_total%0A%20%20%20%20%20%20%20%20text%20medio_verificacion%0A%20%20%20%20%20%20%20%20decimal%20costo_estimado%0A%20%20%20%20%20%20%20%20datetime%20created_at%0A%20%20%20%20%20%20%20%20datetime%20updated_at%0A%20%20%20%20%7D%0A%20%20%20%20POA_PROGRAMACIONES%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20poa_actividad_id%20FK%0A%20%20%20%20%20%20%20%20int%20mes%0A%20%20%20%20%20%20%20%20year%20anio%0A%20%20%20%20%20%20%20%20int%20cantidad_programada%0A%20%20%20%20%20%20%20%20int%20cantidad_ejecutada%0A%20%20%20%20%20%20%20%20text%20causal_desvio%0A%20%20%20%20%20%20%20%20boolean%20es_extraordinaria%0A%20%20%20%20%20%20%20%20datetime%20created_at%0A%20%20%20%20%20%20%20%20datetime%20updated_at%0A%20%20%20%20%7D%0A%20%20%20%20POA_EVIDENCIAS%20%7B%0A%20%20%20%20%20%20%20%20int%20id%20PK%0A%20%20%20%20%20%20%20%20int%20poa_actividad_id%20FK%0A%20%20%20%20%20%20%20%20string%20tipo%0A%20%20%20%20%20%20%20%20string%20archivo%0A%20%20%20%20%20%20%20%20string%20url%0A%20%20%20%20%20%20%20%20string%20descripcion%0A%20%20%20%20%20%20%20%20int%20mes%0A%20%20%20%20%20%20%20%20datetime%20created_at%0A%20%20%20%20%20%20%20%20datetime%20updated_at%0A%20%20%20%20%7D%0A%0A%20%20%20%20UNIDADES%20%7C%7C--o%7B%20USERS%20%3A%20%22tiene%22%0A%20%20%20%20USERS%20%7C%7C--o%7B%20POA_PROYECTOS%20%3A%20%22crea%22%0A%20%20%20%20POA_PROYECTOS%20%7C%7C--%7C%7B%20POA_METAS%20%3A%20%22contiene%22%0A%20%20%20%20POA_METAS%20%7C%7C--%7C%7B%20POA_ACTIVIDADES%20%3A%20%22agrupa%22%0A%20%20%20%20POA_ACTIVIDADES%20%7C%7C--%7C%7B%20POA_PROGRAMACIONES%20%3A%20%22programa%22%0A%20%20%20%20POA_ACTIVIDADES%20%7C%7C--o%7B%20POA_EVIDENCIAS%20%3A%20%22adjunta%22%0A"})]),fallback:t(()=>[...a[0]||(a[0]=[s(" Loading... ",-1)])]),_:1})),a[3]||(a[3]=c(`<h2 id="descripcion-de-modelos" tabindex="-1">Descripción de Modelos <a class="header-anchor" href="#descripcion-de-modelos" aria-label="Permalink to &quot;Descripción de Modelos&quot;">​</a></h2><h3 id="poaactividad-—-el-modelo-central" tabindex="-1"><code>PoaActividad</code> — El modelo central <a class="header-anchor" href="#poaactividad-—-el-modelo-central" aria-label="Permalink to &quot;\`PoaActividad\` — El modelo central&quot;">​</a></h3><p>Es el corazón del sistema. Tiene un observer <code>booted()</code> que al crearse <strong>genera automáticamente 12 registros</strong> de <code>PoaProgramacion</code> (uno por cada mes del año):</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> booted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">created</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($actividad) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $anio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $actividad</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">meta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">proyecto</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">anio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Y&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; $i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; $i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            $batch[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;poa_actividad_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $actividad</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;mes&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">               =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;anio&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $anio,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;cantidad_programada&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        PoaProgramacion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($batch);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="enums-importantes" tabindex="-1">Enums importantes <a class="header-anchor" href="#enums-importantes" aria-label="Permalink to &quot;Enums importantes&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Modelo</th><th>Campo</th><th>Valores</th></tr></thead><tbody><tr><td><code>PoaProyecto</code></td><td><code>estado</code></td><td><code>BORRADOR</code>, <code>ENVIADO</code>, <code>APROBADO</code>, <code>RECHAZADO</code>, <code>OBSERVADO</code></td></tr><tr><td><code>PoaActividad</code></td><td><code>estado_aprobacion</code></td><td><code>PENDIENTE</code>, <code>APROBADO</code>, <code>RECHAZADO</code></td></tr><tr><td><code>PoaEvidencia</code></td><td><code>tipo</code></td><td><code>PDF</code>, <code>FOTO</code>, <code>VIDEO</code>, <code>URL</code>, <code>MP3</code></td></tr></tbody></table><h3 id="constraint-unico-en-poaprogramacion" tabindex="-1">Constraint único en <code>PoaProgramacion</code> <a class="header-anchor" href="#constraint-unico-en-poaprogramacion" aria-label="Permalink to &quot;Constraint único en \`PoaProgramacion\`&quot;">​</a></h3><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UNIQUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(poa_actividad_id, mes, anio)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Evita duplicados de programación por actividad/mes/año.</p><h3 id="softdeletes-en-poaproyecto" tabindex="-1">SoftDeletes en <code>PoaProyecto</code> <a class="header-anchor" href="#softdeletes-en-poaproyecto" aria-label="Permalink to &quot;SoftDeletes en \`PoaProyecto\`&quot;">​</a></h3><p>Los proyectos no se eliminan físicamente inmediatamente — van a la papelera (<code>deleted_at</code>). El Admin puede restaurarlos desde el panel.</p>`,11))])}const D=d(k,[["render",E]]);export{_ as __pageData,D as default};
