import{_ as l,C as d,o as e,c as r,j as s,a as i,b as o,w as n,E as p,a3 as h,a2 as k}from"./chunks/framework.BNd_iFDH.js";const F=JSON.parse('{"title":"Wizard de Planificación","description":"","frontmatter":{},"headers":[],"relativePath":"modules/wizard.md","filePath":"modules/wizard.md","lastUpdated":null}'),c={name:"modules/wizard.md"};function E(u,a,m,g,b,y){const t=d("Mermaid");return e(),r("div",null,[a[1]||(a[1]=s("h1",{id:"wizard-de-planificacion",tabindex:"-1"},[i("Wizard de Planificación "),s("a",{class:"header-anchor",href:"#wizard-de-planificacion","aria-label":'Permalink to "Wizard de Planificación"'},"​")],-1)),a[2]||(a[2]=s("p",null,[s("code",null,"WizardController"),i(" — El módulo más importante del sistema. Guía a la unidad a través de 5 pasos para crear su Plan Operativo Anual.")],-1)),a[3]||(a[3]=s("h2",{id:"flujo-del-wizard",tabindex:"-1"},[i("Flujo del Wizard "),s("a",{class:"header-anchor",href:"#flujo-del-wizard","aria-label":'Permalink to "Flujo del Wizard"'},"​")],-1)),(e(),o(h,null,{default:n(()=>[p(t,{id:"mermaid-9",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A(%5BUnidad%20inicia%20wizard%5D)%20--%3E%20S1%5BPaso%201%3A%20Datos%20del%20Proyecto%5Cnanio%2C%20nombre%2C%20objetivo_unidad%5D%0A%20%20%20%20S1%20--%3E%20S2%5BPaso%202%3A%20Metas%5CnDe%20cat%C3%A1logo%20predeterminado%20o%20personalizada%5D%0A%20%20%20%20S2%20--%3E%20V1%7B%C2%BFAl%20menos%5Cnuna%20meta%3F%7D%0A%20%20%20%20V1%20--%20No%20--%3E%20S2%0A%20%20%20%20V1%20--%20S%C3%AD%20--%3E%20S3%5BPaso%203%3A%20Actividades%5Cnpor%20cada%20meta%5D%0A%20%20%20%20S3%20--%3E%20V2%7B%C2%BFTodas%20las%20metas%5Cntienen%20actividades%3F%7D%0A%20%20%20%20V2%20--%20No%20--%3E%20S3%0A%20%20%20%20V2%20--%20S%C3%AD%20--%3E%20S4%5BPaso%204%3A%20Programaci%C3%B3n%20Mensual%5CnDistribuci%C3%B3n%20mes%20a%20mes%5D%0A%20%20%20%20S4%20--%3E%20V3%7BSuma%20mensual%20%3D%5CnTotal%20anual%7D%0A%20%20%20%20V3%20--%20No%20--%3E%20S4%0A%20%20%20%20V3%20--%20S%C3%AD%20--%3E%20S5%5BPaso%205%3A%20Resumen%20Final%5Cny%20confirmaci%C3%B3n%5D%0A%20%20%20%20S5%20--%3E%20FIN(%5BProyecto%20BORRADOR%5Cnlisto%20para%20enviar%5D)%0A%20%20%20%20FIN%20--%3E%20ENV%5BUnidad%20presiona%20Enviar%5Cnestado%20%E2%86%92%20ENVIADO%5D%0A"})]),fallback:n(()=>[...a[0]||(a[0]=[i(" Loading... ",-1)])]),_:1})),a[4]||(a[4]=k(`<h2 id="validaciones-por-paso-poawizardvalidator" tabindex="-1">Validaciones por Paso (<code>PoaWizardValidator</code>) <a class="header-anchor" href="#validaciones-por-paso-poawizardvalidator" aria-label="Permalink to &quot;Validaciones por Paso (\`PoaWizardValidator\`)&quot;">​</a></h2><p>Las validaciones son <strong>cascada</strong>: el paso N verifica todos los pasos anteriores antes de permitir el acceso.</p><table tabindex="0"><thead><tr><th>Paso</th><th>Regla de negocio</th></tr></thead><tbody><tr><td><strong>Paso 3</strong></td><td>El proyecto debe tener al menos 1 meta</td></tr><tr><td><strong>Paso 4</strong></td><td>Todas las metas deben tener al menos 1 actividad</td></tr><tr><td><strong>Paso 5</strong></td><td>Para actividades cuantificables: <code>suma_mensual == total_anual</code></td></tr></tbody></table><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// PoaWizardValidator::checkDistribution()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$totalAnual  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) $actividad</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cantidad_programada_total;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$sumaMensual </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) $actividad</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">programaciones</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cantidad_programada&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($totalAnual </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $sumaMensual) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Error — rechaza avanzar al paso 5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="comportamiento-automatico-al-crear-actividades" tabindex="-1">Comportamiento automático al crear Actividades <a class="header-anchor" href="#comportamiento-automatico-al-crear-actividades" aria-label="Permalink to &quot;Comportamiento automático al crear Actividades&quot;">​</a></h2><p>Al guardar una <code>PoaActividad</code>, el sistema crea automáticamente <strong>12 registros de <code>PoaProgramacion</code></strong> (uno por mes, todos en 0). Esto ocurre en el método <code>booted()</code> del modelo.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>El usuario solo necesita ingresar los valores en el Paso 4. Las filas mensuales ya existen desde que se crea la actividad.</p></div><h2 id="edicion-solo-en-estado-borrador" tabindex="-1">Edición (solo en estado BORRADOR) <a class="header-anchor" href="#edicion-solo-en-estado-borrador" aria-label="Permalink to &quot;Edición (solo en estado BORRADOR)&quot;">​</a></h2><p>Las metas y actividades se pueden editar con <code>updateMeta()</code> y <code>updateActividad()</code>, pero <strong>únicamente si el proyecto está en estado <code>BORRADOR</code></strong>. El sistema verifica esto antes de guardar.</p><h2 id="flujo-de-envio" tabindex="-1">Flujo de Envío <a class="header-anchor" href="#flujo-de-envio" aria-label="Permalink to &quot;Flujo de Envío&quot;">​</a></h2><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// WizardController::sendProject()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PoaProyecto</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Auth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;estado&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;BORRADOR&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ← Solo borradores</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findOrFail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;estado&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ENVIADO&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,11))])}const D=l(c,[["render",E]]);export{F as __pageData,D as default};
